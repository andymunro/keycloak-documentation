
[[_installing-operator]]
=== Installing {project_operator}

To install the {project_operator} into
ifeval::[{project_community}==true]
a Kubernetes cluster or
endif::[]
an Openshift cluster, you have two options:

* <<_install_by_olm,The Operator Lifecycle Manager (OLM)>>
* <<_install_by_command,Command line installation>>

//dnaro: CLI is community only. for product you install via OLM only.
//CCS convention for linking is to use the xref format.
//<<_install_by_command,Command line installation>>
//link:#_install_by_command[Command line installation]

[[_install_by_olm]]
==== Installing {project_operator} from Operator Lifecycle Manager

ifeval::[{project_community}==true]
You can install the Operator on OpenShift or Kubernetes.

===== Installation on an OpenShift cluster
endif::[]

.Prerequisites

You have cluster administrator permissions or an equivalent level of permissions granted by an administrator.

.Procedure

//dnaro: do not mention OS version here. that will get out of date quickly.
For an OpenShift 4.3 cluster, perform these steps:

. Open the OpenShift Container Platform web console.

. In the left column, select `Operators, OperatorHub`.

. Search for {project_name} Operator.
+
.OperatorHub tab in OpenShift
image:{project_images}/operator-openshift-operatorhub.png[]

. Click the {project_name} Operator icon.
+
An Install page opens.
+
.Operator Install page on OpenShift
image:{project_images}/operator-olm-installation.png[]

. Click `Install`.

. Select a namespace and click `Subscribe`.
+
.Namespace selection in OpenShift
image:images/installed-namespace.png[]
+
The Operator starts installing.

ifeval::[{project_community}==true]

===== Installation on a Kubernetes cluster

.Prerequisites

You have cluster administrator permissions or an equivalent level of permissions granted by an administrator.

.Procedure

For a Kubernetes cluster, perform these steps:

. Go to link:https://operatorhub.io/operator/keycloak-operator[Keycloak Operator on OperatorHub.io].

. Click `Install`.

. Follow the instructions on the screen.
+
.Operator Install page on Kubernetes
image:{project_images}/operator-operatorhub-install.png[]

endif::[]

When the Operator installation completes, you can apply custom resources to install {project_name}, create realms, and perform other adminstrative tasks.

.Additional Resources

ifeval::[{project_community}==true]
* link:https://operatorhub.io/how-to-install-an-operator[How to install an Operator from OperatorHub.io]
endif::[]

//dnaro: you mentioned 4.3 earlier but this link points to 4.2
* link:https://docs.openshift.com/container-platform/4.2/operators/olm-what-operators-are.html[OpenShift Operators Guide]

//dnaro: typo in the URL causes 404
//think we can drop this link
For more information on OpenShift installation, see link:https://access.redhat.com/documentation/en-us/openshift_container_platform/4.3/html/installing/index[Installing and Configuring OpenShift Container Platform clusters].

[[_install_by_command]]
==== Installing {project_operator} manually

//dnaro: this should be community only. for product you install via OLM only.
You can install the {project_operator} at the command line.

.Prerequisites

You have cluster administrator permissions or an equivalent level of permissions granted by an administrator.

.Procedure

//dnaro: clone the Keycloak repo?
. Access the software by using the link:{operatorRepo_link}[Github repo].

//dnaro: how does the user know which CRDs are required?
//what is the order in which the CRDs should be installed?
//why is "Definitions" in caps?
//for community the commands should use the kubectl client, not the oc client
. Install all required custom resource Definitions.
+
[source,bash,subs=+attributes]
----
$ oc create -f deploy/crds/
----

. Create a new namespace (or reuse an existing one). In this example, the namespace is `myproject`.
+
[source,bash,subs=+attributes]
----
$ oc create namespace myproject
----

. Deploy a role, role binding, and service account for the Operator.
+
[source,bash,subs=+attributes]
----
$ oc create -f deploy/role.yaml -n myproject
$ oc create -f deploy/role_binding.yaml -n myproject
$ oc create -f deploy/service_account.yaml -n myproject
----

. Deploy the Operator.
+
[source,bash,subs=+attributes]
----
$ oc create -f deploy/operator.yaml -n myproject
----

. Confirm that the Operator is running:
+
[source,bash,subs=+attributes]
----
$ oc get deployment keycloak-operator
NAME                READY   UP-TO-DATE   AVAILABLE   AGE
keycloak-operator   1/1     1            1           41s
----

You are ready to create custom resources to install {project_name}, create realms, and perform other adminstrative tasks.

[NOTE]
When deploying the Operator to an OpenShift cluster, `oc create` commands can be replaced with their `kubectl apply` counterparts.
