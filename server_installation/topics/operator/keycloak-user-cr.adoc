
[[_user-cr]]
=== Creating a user custom resource

You can use the Operator to create users in {project_name} as defined by a custom resource. You define the properties of the user custom resource in a YAML file.

[NOTE]
You can update properties, except for the password, in the YAML file and changes appear in the {project_name} admin console, however changes to the admin console do not update the custom resource.

.Example YAML file for a User custom resource
```yaml
apiVersion: keycloak.org/v1alpha1
kind: KeycloakUser
metadata:
  name: example-realm-user
spec:
  user:
    username: "realm_user"
    firstName: "John"
    lastName: "Doe"
    email: "user@example.com"
    enabled: True
    emailVerified: False
    realmRoles:
      - "offline_access"
    clientRoles:
      account:
        - "manage-account"
      realm-management:
        - "manage-users"
  realmSelector:
    matchLabels:
      app: sso
```

.Prerequisites

* You have a YAML file for this custom resource.

* The `realmSelector` matches the labels of an existing realm custom resource.

.Procedure

. Use this command on the YAML file that you created: `oc create -f <user_cr>.yaml`. For example:
+
[source,bash,subs=+attributes]
----
$ oc create -f initial_user.yaml
westover.org/initial_user created
----

. Log into the admin console for the related instance of {project_name}.

. Choose Users.

. Search for the user you defined in the YAML file.
+
The user appears in the list.
+
image:images/user_list.png[]

.Results

After a user is created, the Operator creates a Secret containing the both username and password using the
following naming pattern: `credential-<realm name>-<user name>-<namespace>`. Here's an example:

.`KeycloakUser` Secret
```
kind: Secret
apiVersion: v1
data:
  password: <base64 encoded password>
  username: <base64 encoded username>
type: Opaque
```
Once the Operator processes the custom resource, view the status with this command:

[source,bash,subs=+attributes]
----
$ oc describe keycloak <cr_name>
----

.User custom resource Status
```yaml
Name:         example-realm-user
Namespace:    keycloak
Labels:       app=sso
API Version:  keycloak.org/v1alpha1
Kind:         KeycloakUser
Spec:
  Realm Selector:
    Match Labels:
      App:  sso
  User:
    Email:           realm_user@redhat.com
    Credentials:
      Type:          password
      Value:         <user password>
    Email Verified:  false
    Enabled:         true
    First Name:      John
    Last Name:       Doe
    Username:        realm_user
Status:
  Message:
  Phase:    reconciled
Events:     <none>
```
